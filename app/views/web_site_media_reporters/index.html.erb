<%= form_tag({},:method=>'get',:style=>"vertical-align: middle;") do -%>
<%= render_cell(:page_title, :show, data:{name: "#{t('model.list', model: WebSiteMediaReporter.model_name.human)}",
                                          toolbar: {
                                                  right:
                                                          [
                                                                  (render_cell(:button, :show, data:
                                                                          {
                                                                                  name: fa_icon('plus-sign', text: t('model.create', :model => WebSiteMediaReporter.model_name.human)),
                                                                                  url: new_web_site_media_reporter_path,
                                                                                  options: {class: 'btn btn-primary'}
                                                                          })),
                                                                  render_cell(
                                                                          :button,
                                                                          :show,
                                                                          data:
                                                                                  {
                                                                                          name: fa_icon('cloud-upload', text: t('model.upload', model: WebSiteMediaReporter.model_name.human)),
                                                                                          url: upload_reporter_info_path,
                                                                                          options: {class: 'btn btn-success'}
                                                                                  }
                                                                  ),
                                                                  render_cell(:button, :show,
                                                                              data:
                                                                                      {
                                                                                              name: fa_icon('download-alt', text: t('model.download',:model => WebSiteMediaReporter.model_name.human)),
                                                                                              url: download_reporter_info_path(params),
                                                                                              options:
                                                                                                      {
                                                                                                              class: 'btn btn-info',
                                                                                                              method: :post
                                                                                                      }
                                                                                      }
                                                                  )

                                                          ]
                                          }
})
%>

<div class="well" style="vertical-align: middle;">


      地区:
      <%= select_tag('region_id',options_for_select([['全部',0]]+@regions,params[:region_id]),:style=>"width:100px") -%>
      <%= select_tag('province_id',options_for_select([['全部',0]]+@provinces,params[:province_id]),:style=>"width:120px") -%>
      <%= select_tag('city_id',options_for_select([['全部',0]]+@cities,params[:city_id]),:style=>"width:100px") -%>
      媒体介质:
      <%= select_tag('format_id',options_for_select([['全部',0]]+WebSiteMediaReporter::FORMATS,params[:format_id]),:style=>"width:100px") -%>
      媒体名称:
      <%= text_field_tag 'media_name',params[:media_name],:style=>"width:100px"-%>
      媒体级别:
      <%= select_tag('level',options_for_select([['全部',nil]]+WebSiteMediaReporter::LEVELS,params[:level]),:style=>"width:60px") -%>
      姓名:
      <%= text_field_tag 'name',params[:name],:style=>"width:60px"-%>
      性别:
      <%= select_tag('sex',options_for_select([['全部',nil],['男','1'],['女','0']],params[:sex]),:style=>"width:60px") -%>
      部门名称:
      <%= text_field_tag 'department_name',params[:department_name],:style=>"width:100px"-%>
      生日:
      <%= date_selector({:name=>'birthday_start',:id=>'birthday_start',:value=>params[:birthday_start]}) -%>
      到
      <%= date_selector({:name=>'birthday_end',:id=>'birthday_end',:value=>params[:birthday_end]}) -%>
  分站？
  <%= check_box_tag 'is_substation','1',params[:is_substation]=='1' -%>
      <%= submit_tag('查询',:style=>"margin-bottom: 10px;") -%>

</div>
<% end -%>

<%= grid(@reporters_grid, :show_filters => :when_filtered,:class=> 'tablestyle') do |g|

  g.column name: t('activerecord.attributes.web_site_media_reporter.region_id') do |reporter|

    if reporter.is_substation==1
      reporter.region_name.to_s+"(分站)"
    else
      reporter.region_name
    end
  end
  g.column name: t('activerecord.attributes.web_site_media_reporter.province_id') do |reporter|
    reporter.province_name
  end
  g.column name: t('activerecord.attributes.web_site_media_reporter.city_id') do |reporter|
    reporter.city_name
  end
  g.column name: t('activerecord.attributes.web_site_media_reporter.format_id') do |reporter|
    reporter.format_type
  end

  WebSiteMediaReporter::ATTR.each do |a|
    g.column name: t('activerecord.attributes.web_site_media_reporter.'+a.to_s) do |reporter|
     if a=='married'
       if reporter[a].blank?
          ''
       else
         reporter[a] == false ? '未婚' : '已婚'
       end
     elsif a== 'sex'
       reporter[a].to_i ==0 ? '女' : '男'
     elsif a== 'birthday'
       reporter[a].to_s.gsub('年','-').gsub('月','-').gsub('日','')
     else
       reporter[a]
     end
    end
  end

  g.column name: t('activerecord.attributes.traveling_photography_media_info.created_at') do |m|
    m.created_at.strftime('%Y-%m-%d')
  end

  g.column name: t('activerecord.attributes.traveling_photography_media_info.created_by') do |m|
    m.created_name
  end

  g.column name: t('activerecord.attributes.traveling_photography_media_info.updated_at') do |m|
    m.updated_at.strftime('%Y-%m-%d')
  end

  g.column name: t('activerecord.attributes.traveling_photography_media_info.updated_by') do |m|
    m.updated_name
  end

  g.column html: {class: 'btn-cell'} do |p|
    link_to(fa_icon('edit'), edit_web_site_media_reporter_path(p), :class => 'btn', :rel => 'tooltip', :title => t('buttons.edit'))
  end

  g.column html: {class: 'btn-cell'} do |p|
    link_to(fa_icon('trash'), web_site_media_reporter_path(p), :method => :delete, :confirm => t("confirms.delete"), :class => 'btn btn-danger', :rel => 'tooltip', :title => t('buttons.delete'))
  end

end -%>
<style type="text/css">
   .tablestyle{
       width: 4000px;
   }

   #grid{
       overflow: auto;
   }

</style>
            <script>
                $('#grid').attr('style','height:750px');
            </script>

<script language='javascript'>
    $(document).ready(function(){
        $('#region_id').bind('change',function(){
            var web_site_media_reporter_region_id = $('#region_id').val();
            $.ajax({
                url: '/web_site_media_reporters/ajax_get_provinces/' + web_site_media_reporter_region_id.toString(),
                type: 'GET',
                data: {
                },
                success: function(data) {
                    if(web_site_media_reporter_region_id=='0'){
                        $('#province_id').html("<option value='0'>全部</option>");
                        $('#city_id').html("<option value='0'>全部</option>");
                    }else{
                        data = "<option value='0'>全部</option>"+data
                        $('#province_id').html(data);
                    }
                }
            });
        })

        $('#province_id').bind('change',function(){
            var web_site_media_reporter_province_id = $('#province_id').val();
            $.ajax({
                url: '/web_site_media_reporters/ajax_get_cities/' + web_site_media_reporter_province_id.toString(),
                type: 'GET',
                data: {
                },
                success: function(data) {
                    if(web_site_media_reporter_province_id=='0'){
                        $('#city_id').html("<option value='0'>全部</option>");
                    }else{
                        data = "<option value='0'>全部</option>"+data
                        $('#city_id').html(data);
                    }
                }
            });
        })
    });
</script>


